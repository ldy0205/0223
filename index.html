<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>ë•ë•ì´</title>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --cream:    #fdf6ec;
      --warm0:    #fff9f2;
      --warm1:    #fdebd0;
      --warm2:    #f5cba7;
      --amber:    #e8965a;
      --amber-d:  #c97a3f;
      --brown:    #7a4f2e;
      --brown-l:  #a07050;
      --sage:     #8aab90;
      --sage-l:   #c5ddc8;
      --surface:  #ffffff;
      --text:     #3d2b1f;
      --text-mid: #7a5c48;
      --text-dim: #b89a88;
      --border:   #e8d5c4;
      --shadow:   rgba(122,79,46,0.10);
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    html, body { height:100%; background:var(--cream); color:var(--text); font-family:'Gowun Dodum', sans-serif; overflow:hidden; }

    body::before {
      content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(ellipse 80% 60% at 10% 0%,  rgba(253,235,208,.7) 0%, transparent 60%),
        radial-gradient(ellipse 60% 50% at 90% 100%, rgba(197,221,200,.4) 0%, transparent 60%);
    }

    .app {
      position:relative; z-index:1;
      height:100dvh;
      display:grid;
      grid-template-rows:auto 1fr auto;
      max-width:780px;
      margin:0 auto;
      padding:0 1.2rem;
    }

    header {
      display:flex; align-items:center; justify-content:space-between;
      padding:1.2rem 0;
      border-bottom:1px solid var(--border);
    }

    .haru-identity { display:flex; align-items:center; gap:.9rem; }
    .haru-avatar {
      width:46px; height:46px; border-radius:50%;
      background:linear-gradient(135deg,var(--warm2),var(--amber));
      display:flex; align-items:center; justify-content:center;
      font-size:1.4rem; box-shadow:0 4px 12px var(--shadow);
    }
    .haru-name { font-family:'DM Serif Display',serif; font-size:1.3rem; color:var(--brown); }
    .haru-status { font-size:.75rem; color:var(--sage); margin-top:2px; }

    .clear-btn {
      background:white; border:1px solid var(--border); border-radius:100px;
      padding:.4rem .8rem; font-size:.75rem; color:var(--text-dim);
      cursor:pointer; font-family:inherit;
    }

    .messages {
      overflow-y:auto; padding:1.5rem 0;
      display:flex; flex-direction:column; gap:1.2rem;
    }

    .msg-row { display:flex; align-items:flex-end; gap:.65rem; animation:msgIn .3s ease-out; }
    @keyframes msgIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    .msg-row.user { flex-direction:row-reverse; }

    .bubble { max-width:75%; padding:.8rem 1rem; border-radius:18px; line-height:1.6; font-size:.95rem; word-break: break-all; }
    .msg-row.ai .bubble { background:white; border:1px solid var(--border); border-bottom-left-radius:4px; }
    .msg-row.user .bubble { background:var(--amber); color:white; border-bottom-right-radius:4px; }

    .welcome { text-align:center; padding:3rem 1rem; color:var(--brown); }
    .welcome-chips { display:flex; flex-wrap:wrap; justify-content:center; gap:0.6rem; margin-top:1.5rem; }
    .chip {
      background:white; border:1px solid var(--border); border-radius:100px;
      padding:0.5rem 1rem; font-size:0.85rem; cursor:pointer;
    }

    .input-area { padding:1.2rem 0 1.5rem; }
    .input-box {
      background:white; border:1.5px solid var(--border); border-radius:24px;
      padding:0.5rem 0.5rem 0.5rem 1.2rem; display:flex; align-items:center; gap:0.5rem;
      box-shadow:0 4px 12px var(--shadow);
    }
    textarea {
      flex:1; border:none; outline:none; background:transparent;
      font-family:inherit; font-size:1rem; resize:none; max-height:100px;
    }
    .send-btn {
      width:40px; height:40px; border-radius:50%; border:none;
      background:var(--amber); color:white; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
    }

    /* TYPING DOTS */
    .typing { display:flex; gap:4px; padding:4px 0; }
    .typing span { width:6px; height:6px; background:var(--amber); border-radius:50%; animation: blink 1.4s infinite; }
    .typing span:nth-child(2) { animation-delay: .2s; }
    .typing span:nth-child(3) { animation-delay: .4s; }
    @keyframes blink { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
  </style>
</head>
<body>

<div class="app">
  <header>
    <div class="haru-identity">
      <div class="haru-avatar">ğŸ¾</div>
      <div>
        <div class="haru-name">DUCK-DUCK</div>
        <div class="haru-status">ë¬´ìŠ¨ ìƒê°í•´? ë‚˜í•œí…Œ ë§í•´ë´.</div>
      </div>
    </div>
    <button class="clear-btn" onclick="clearChat()">ë‹¤ì‹œ ì‹œì‘</button>
  </header>

  <main class="messages" id="messages">
    <div class="welcome" id="welcome">
      <div class="welcome-icon" style="font-size:3rem;">ğŸ¾</div>
      <h2>ì•ˆë…•! ë‚˜ ë•ë•ì´ì•¼.</h2>
      <p>ê¶ê¸ˆí•œ ê²Œ ìˆê±°ë‚˜ ì‹¬ì‹¬í•˜ë©´ ë§ ê±¸ì–´ì¤˜!</p>
      <div class="welcome-chips">
        <div class="chip" onclick="sendChip(this)">ì¬ë¯¸ìˆëŠ” ì–˜ê¸° í•´ì¤˜</div>
        <div class="chip" onclick="sendChip(this)">ê¸°ë¶„ ì „í™˜í•˜ëŠ” ë²•?</div>
        <div class="chip" onclick="sendChip(this)">ì˜¤ëŠ˜ ë‚ ì”¨ ì–´ë•Œ?</div>
      </div>
    </div>
  </main>

  <footer class="input-area">
    <div class="input-box">
      <textarea id="chatInput" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." rows="1" onkeydown="handleKey(event)"></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
      </button>
    </div>
  </footer>
</div>

<script>
let chatHistory = [];
const input = document.getElementById('chatInput');
const container = document.getElementById('messages');

function addBubble(role, text) {
  const welcome = document.getElementById('welcome');
  if (welcome) welcome.remove();

  const row = document.createElement('div');
  row.className = `msg-row ${role}`;
  row.innerHTML = `
    <div class="msg-avatar" style="background:${role==='ai'?'#f5cba7':'#8aab90'}">${role==='ai'?'ğŸ¾':'ğŸ‘¤'}</div>
    <div class="bubble">${text}</div>
  `;
  container.appendChild(row);
  container.scrollTop = container.scrollHeight;
}

function setTyping(show) {
  let row = document.getElementById('typingRow');
  if (show && !row) {
    row = document.createElement('div');
    row.id = 'typingRow'; row.className = 'msg-row ai';
    row.innerHTML = `<div class="msg-avatar" style="background:#f5cba7">ğŸ¾</div><div class="bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
    container.appendChild(row);
    container.scrollTop = container.scrollHeight;
  } else if (!show && row) {
    row.remove();
  }
}

async function sendMessage(text) {
  const msg = text || input.value.trim();
  if (!msg) return;
  if (!text) input.value = '';

  addBubble('user', msg);
  chatHistory.push({ role: 'user', content: msg });

  setTyping(true);
  try {
    const res = await fetch('/.netlify/functions/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ messages: chatHistory })
    });
    
    if (!res.ok) throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
    
    const data = await res.json();
    setTyping(false);
    
    const aiMsg = data.choices[0].message.content;
    addBubble('ai', aiMsg);
    chatHistory.push({ role: 'assistant', content: aiMsg });
  } catch (err) {
    setTyping(false);
    addBubble('ai', "ì—ëŸ¬ê°€ ë°œìƒí–ˆì–´: " + err.message);
  }
}

function sendChip(el) { sendMessage(el.textContent); }

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function clearChat() {
  chatHistory = [];
  location.reload();
}
</script>

</body>
</html>